# POKERTOOL-HEADER-START
# ---
# schema: pokerheader.v1
# project: pokertool
# file: pokertool-frontend/node_modules/spdy/lib/spdy/request.js
# version: v20.0.0
# last_commit: '2025-09-23T07:20:25+01:00'
# fixes:
# - date: '2025-09-25'
#   summary: Enhanced enterprise documentation and comprehensive unit tests added
# ---
# POKERTOOL-HEADER-END
'use strict'

function attachPush (req) {
  var handle = req.socket._handle

  handle.getStream(function (stream) {
    stream.on('pushPromise', function (push) {
      req.emit('push', push)
    })
  })
}

exports.onNewListener = function onNewListener (type) {
  var req = this

  if (type !== 'push') {
    return
  }

  // Not first listener
  if (req.listeners('push').length !== 0) {
    return
  }

  if (!req.socket) {
    req.on('socket', function () {
      attachPush(req)
    })
    return
  }

  attachPush(req)
}
