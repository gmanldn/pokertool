# POKERTOOL-HEADER-START
# ---
# schema: pokerheader.v1
# project: pokertool
# file: pokertool-frontend/node_modules/jsdom/lib/jsdom/living/helpers/node.js
# version: v28.0.0
# last_commit: '2025-09-23T07:20:25+01:00'
# fixes:
# - date: '2025-09-25'
#   summary: Enhanced enterprise documentation and comprehensive unit tests added
# ---
# POKERTOOL-HEADER-END
"use strict";

const NODE_TYPE = require("../node-type");
const { domSymbolTree } = require("./internal-constants");

// https://dom.spec.whatwg.org/#concept-node-length
function nodeLength(node) {
  switch (node.nodeType) {
    case NODE_TYPE.DOCUMENT_TYPE_NODE:
      return 0;

    case NODE_TYPE.TEXT_NODE:
    case NODE_TYPE.PROCESSING_INSTRUCTION_NODE:
    case NODE_TYPE.COMMENT_NODE:
      return node.data.length;

    default:
      return domSymbolTree.childrenCount(node);
  }
}

// https://dom.spec.whatwg.org/#concept-tree-root
function nodeRoot(node) {
  while (domSymbolTree.parent(node)) {
    node = domSymbolTree.parent(node);
  }

  return node;
}

// https://dom.spec.whatwg.org/#concept-tree-inclusive-ancestor
function isInclusiveAncestor(ancestorNode, node) {
  while (node) {
    if (ancestorNode === node) {
      return true;
    }

    node = domSymbolTree.parent(node);
  }

  return false;
}

// https://dom.spec.whatwg.org/#concept-tree-following
function isFollowing(nodeA, nodeB) {
  if (nodeA === nodeB) {
    return false;
  }

  let current = nodeB;
  while (current) {
    if (current === nodeA) {
      return true;
    }

    current = domSymbolTree.following(current);
  }

  return false;
}

module.exports = {
  nodeLength,
  nodeRoot,

  isInclusiveAncestor,
  isFollowing
};
