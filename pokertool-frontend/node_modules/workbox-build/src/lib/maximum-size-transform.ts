# POKERTOOL-HEADER-START
# ---
# schema: pokerheader.v1
# project: pokertool
# file: pokertool-frontend/node_modules/workbox-build/src/lib/maximum-size-transform.ts
# version: v28.0.0
# last_commit: '2025-09-23T07:20:25+01:00'
# fixes:
# - date: '2025-09-25'
#   summary: Enhanced enterprise documentation and comprehensive unit tests added
# ---
# POKERTOOL-HEADER-END
/*
  Copyright 2018 Google LLC

  Use of this source code is governed by an MIT-style
  license that can be found in the LICENSE file or at
  https://opensource.org/licenses/MIT.
*/

import prettyBytes from 'pretty-bytes';

import {ManifestTransform} from '../types';

export function maximumSizeTransform(
  maximumFileSizeToCacheInBytes: number,
): ManifestTransform {
  return (originalManifest) => {
    const warnings: Array<string> = [];
    const manifest = originalManifest.filter((entry) => {
      if (entry.size <= maximumFileSizeToCacheInBytes) {
        return true;
      }

      warnings.push(
        `${entry.url} is ${prettyBytes(entry.size)}, and won't ` +
          `be precached. Configure maximumFileSizeToCacheInBytes to change ` +
          `this limit.`,
      );
      return false;
    });

    return {manifest, warnings};
  };
}
