#!/usr/bin/env node
# POKERTOOL-HEADER-START
# POKERTOOL-HEADER-START
# ---
# schema: pokerheader.v1
# project: pokertool
# file: pokertool-frontend/node_modules/.bin/detect-port
# version: v20.0.0
# last_commit: '2025-09-23T07:20:25+01:00'
# fixes:
# - date: '2025-09-25'
#   summary: Enhanced enterprise documentation and comprehensive unit tests added
# - date: '2025-09-25'
#   summary: Enhanced enterprise documentation and comprehensive unit tests added
# ---
# POKERTOOL-HEADER-END
'use strict';

const pkg = require('../package');

const args = process.argv.slice(2);
const arg_0 = args[0];

if (!!~['-v', '--version'].indexOf(arg_0)) {
  console.log(pkg.version);
  process.exit(0);
}

const port = parseInt(arg_0, 10);

const main = require('..');

if (!arg_0) {
  const random = Math.floor(9000 + Math.random() * (65535 - 9000));

  main(random, (err, port) => {
    if (err) {
      console.log(`get available port failed with ${err}`);
    }
    console.log(`get available port ${port} randomly`);
  });
} else if (isNaN(port)) {
  console.log();
  console.log(`  \u001b[37m${pkg.description}\u001b[0m`);
  console.log();
  console.log('  Usage:');
  console.log();
  console.log(`    ${pkg.name} [port]`);
  console.log();
  console.log('  Options:');
  console.log();
  console.log('    -v, --version    show version and exit');
  console.log('    -h, --help       output usage information');
  console.log();
  console.log('  Further help:');
  console.log();
  console.log(`    ${pkg.homepage}`);
  console.log();
} else {
  main(port, (err, _port) => {
    if (err) {
      console.log(`get available port failed with ${err}`);
    }

    if (port !== _port) {
      console.log(`port ${port} was occupied`);
    }
    console.log(`get available port ${_port}`);
  });
}